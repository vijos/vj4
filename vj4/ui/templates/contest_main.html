{% extends "layout/basic.html" %}
{% macro render_important_contest(view, title, tdoc) %}
<div class="section immersive--content section--contest {{ view }}">
  <div class="media">
    <div class="media__body middle">
      <div class="section__body">
        <div>
          <h2 class="status_title">{{ _(title) }}</h2>
        </div>
        <h1>{{ tdoc['title'] }}</h1>
        <ul class="info">
          <li>
            <span class="icon icon-award"></span>
            {{ _('Rule') }}: {{ vj4.model.adaptor.contest.RULE_TEXTS[tdoc['rule']] }}
          </li>
          <li>
            <span class="icon icon-calendar"></span>
            {{ _('Start at') }}: {{ datetime_span(tdoc['begin_at']) }}
          </li>
          <li>
            <span class="icon icon-schedule"></span>
            {{ _('Duration') }}: {{ ((tdoc['end_at'] - tdoc['begin_at']).total_seconds() / 3600)|round(2) }} {{ _('hour(s)') }}
          </li>
        </ul>
      </div>
    </div>
    <div class="media__right middle">
      <div class="section__body">
        <a href="{{ reverse_url('contest_detail', tid=tdoc['doc_id']) }}" class="detail-button">{{ _('View Detail') }}</a>
        <div class="typo text-center">
        {% if tsdict[tdoc['doc_id']]['attend'] == 1 %}
          <p><span class="icon icon-check"></span> {{ _('Attended') }}</p>
        {% else %}
          <p><span class="icon icon-schedule"></span> {{ _('Unattended') }}</p>
        {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endmacro %}
{% block content %}
<div class="row">
  <div class="medium-9 columns">
  {% for tdoc in tdocs if vj4.handler.contest.status_func(tdoc, now) == vj4.handler.contest.STATUS_LIVE %}
    {{ render_important_contest('live', 'Live...', tdoc) }}
  {% endfor %}
  {% for tdoc in tdocs if vj4.handler.contest.status_func(tdoc, now) == vj4.handler.contest.STATUS_READY %}
    {{ render_important_contest('ready', 'Ready (☆▽☆)', tdoc) }}
  {% endfor %}
    <div class="section">
      <div class="section__header">
        <h1 class="section__title">{{ _('All Contests') }}</h1>
      </div>
      <div class="section__body"><ol class="contest__list">
      {% for row in tdocs|batch(3, '') %}
        <div class="row">
        {% for tdoc in row %}
          <div class="medium-4 columns">
          {% if not tdoc %}
            &nbsp;
          {% else %}
            <li class="contest__item"><a href="{{ reverse_url('contest_detail', tid=tdoc['doc_id']) }}" class="contest__card">
              <div class="contest__card__image cci--{{ tdoc['doc_id'].binary[-1] % 16 }}">
                <div class="contest__card__info">
                  <h1>{{ tdoc['title'] }}</h1>
                  <ul>
                    <li>
                      <span class="icon icon-award"></span>
                      {{ vj4.model.adaptor.contest.RULE_TEXTS[tdoc['rule']] }}
                    </li>
                    <li>
                      <span class="icon icon-calendar"></span>
                      {{ datetime_span(tdoc['begin_at']) }}
                    </li>
                  </ul>
                </div>
              </div>
            </li></a>
          {% endif %}
          </div>
        {% endfor %}
        </div>
      {% endfor %}
      </ol></div>
    </div>
  </div>
  <div class="medium-3 columns">
  {% if handler.has_perm(vj4.model.builtin.PERM_CREATE_CONTEST) %}
    <div class="section side">
      <div class="section__header">
        <h1 class="section__title">
          {{ _('Create Contest') }}
        </h1>
      </div>
      <div class="section__body">
        <p><a href="{{ reverse_url('contest_create') }}" class="expanded primary button">{{ _('Create a contest') }}</a></p>
      </div>
    </div>
  {% endif %}
  </div>
</div>
{% endblock %}
